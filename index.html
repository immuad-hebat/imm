<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pemilihan Formatur JPMIPA IMM</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>
 <style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    :root {
        --maroon: #800000;
        --light-maroon: #a52a2a;
        --dark-maroon: #5a0000;
        --cream: #f5f5dc;
        --gold: #daa520;
        --light-gold: #f0d483;
        --success: #28a745;
        --danger: #dc3545;
    }

    body {
        background-color: var(--cream);
        color: #333;
        line-height: 1.6;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
    }

    /* Header Styles - IMPROVED */
    header {
        background: linear-gradient(135deg, var(--dark-maroon), var(--maroon));
        color: white;
        padding: 0.8rem 0;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        position: sticky;
        top: 0;
        z-index: 1000;
    }

    .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .logo {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .logo-icon {
        width: 50px;
        height: 50px;       
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .logo i {
        font-size: 1.8rem;
        color: var(--dark-maroon);
    }

    .logo-text h1 {
        font-size: 1.6rem;
        font-weight: 700;
        line-height: 1.2;
    }

    .logo-text span {
        font-size: 0.9rem;
        display: block;
        font-weight: 400;
        opacity: 0.9;
    }

    nav ul {
        display: flex;
        list-style: none;
        gap: 5px;
    }

    nav ul li {
        position: relative;
    }

    nav ul li a {
        color: white;
        text-decoration: none;
        font-weight: 500;
        padding: 8px 16px;
        border-radius: 6px;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    nav ul li a:hover {
        background: rgba(255, 255, 255, 0.15);
        transform: translateY(-2px);
    }

    nav ul li a.active {
        background: rgba(255, 255, 255, 0.2);
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .user-info {
        display: none;
        align-items: center;
        background: rgba(255, 255, 255, 0.15);
        padding: 6px 14px;
        border-radius: 20px;
        margin-left: 10px;
        gap: 8px;
        font-size: 0.9rem;
    }

    .user-info i {
        font-size: 1rem;
    }

    /* Mobile Menu Button */
    .mobile-menu-btn {
        display: none;
        background: none;
        border: none;
        color: white;
        font-size: 1.5rem;
        cursor: pointer;
        padding: 5px;
    }

    /* Hero Section */
    .hero {
        background: linear-gradient(rgba(128, 0, 0, 0.8), rgba(128, 0, 0, 0.9)), url('https://images.unsplash.com/photo-1523580494863-6f3031224c94?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80');
        background-size: cover;
        background-position: center;
        color: white;
        text-align: center;
        padding: 5rem 0;
        margin-bottom: 2rem;
    }

    .hero h2 {
        font-size: 2.5rem;
        margin-bottom: 1rem;
    }

    .hero p {
        font-size: 1.2rem;
        max-width: 700px;
        margin: 0 auto 2rem;
    }

    .btn {
        display: inline-block;
        background: var(--gold);
        color: white;
        padding: 12px 30px;
        border-radius: 5px;
        text-decoration: none;
        font-weight: bold;
        transition: all 0.3s;
        border: none;
        cursor: pointer;
    }

    .btn:hover {
        background: #b8860b;
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .btn-secondary {
        background: var(--light-maroon);
    }

    .btn-secondary:hover {
        background: var(--dark-maroon);
    }

    .btn-danger {
        background: var(--danger);
    }

    .btn-danger:hover {
        background: #c82333;
    }

    /* Candidates Section */
    .section-title {
        text-align: center;
        margin: 3rem 0 2rem;
        color: var(--maroon);
        position: relative;
    }

    .section-title:after {
        content: '';
        display: block;
        width: 100px;
        height: 3px;
        background: var(--maroon);
        margin: 10px auto;
    }

    .candidates {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
        margin-bottom: 3rem;
    }

    .candidate-card {
        background: white;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s;
    }

    .candidate-card:hover {
        transform: translateY(-10px);
    }

    .candidate-img {
        height: 250px;
        background-color: var(--light-maroon);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 5rem;
        overflow: hidden;
    }

    .candidate-img img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .candidate-info {
        padding: 1.5rem;
    }

    .candidate-info h3 {
        color: var(--maroon);
        margin-bottom: 0.5rem;
    }

    .candidate-info p {
        margin-bottom: 1rem;
        color: #666;
    }

    /* Vote Section - MODIFIED untuk multiple selection */
    .vote-section {
        background: white;
        border-radius: 10px;
        padding: 2rem;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        margin-bottom: 3rem;
    }

    .vote-section p:first-of-type {
        margin-bottom: 1.5rem;
        padding: 1rem;
        background: #fff9e6;
        border-radius: 5px;
        border-left: 4px solid var(--gold);
        font-weight: 500;
    }

    .vote-options {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin: 2rem 0;
    }

    .vote-option {
        flex: 1;
        min-width: 200px;
        text-align: center;
        padding: 1rem;
        border: 2px solid #ddd;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
        position: relative;
    }

    .vote-option:hover {
        border-color: var(--maroon);
        transform: translateY(-2px);
        box-shadow: 0 2px 8px rgba(128, 0, 0, 0.1);
    }

    .vote-option.selected {
        border-color: var(--maroon);
        background: rgba(128, 0, 0, 0.08);
        box-shadow: 0 4px 12px rgba(128, 0, 0, 0.2);
        transform: translateY(-2px);
    }

    .vote-option.selected::after {
        content: '✓';
        position: absolute;
        top: 8px;
        right: 8px;
        background: var(--maroon);
        color: white;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.8rem;
        font-weight: bold;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    /* NEW: Vote option ketika mencapai batas maksimal */
    .vote-option.max-reached:not(.selected) {
        opacity: 0.5;
        cursor: not-allowed;
        background: #f8f9fa;
    }

    .vote-option.max-reached:not(.selected):hover {
        border-color: #ddd;
        transform: none;
        box-shadow: none;
    }

    .vote-option-img {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        overflow: hidden;
        margin: 0 auto 10px;
        background: #f0f0f0;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 2px solid var(--maroon);
        transition: all 0.3s;
    }

    .vote-option.selected .vote-option-img {
        border-color: var(--dark-maroon);
        box-shadow: 0 0 0 2px var(--maroon);
    }

    .vote-option-img img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    /* Selection Counter & Validation - NEW */
    .selection-info {
        margin: 1.5rem 0;
        padding: 1.2rem;
        background: #f8f9fa;
        border-radius: 8px;
        border-left: 4px solid var(--maroon);
    }

    .selection-counter {
        text-align: center;
        margin-bottom: 0.5rem;
    }

    .selection-counter p {
        margin: 0;
        font-weight: 600;
        font-size: 1.1rem;
    }

    #selectedCount {
        color: var(--maroon);
        font-weight: bold;
        font-size: 1.3em;
    }

    /* Validation Message Styles - NEW */
    #validationMessage {
        text-align: center;
        font-weight: 500;
        min-height: 24px;
        padding: 0.3rem 0;
        transition: all 0.3s ease;
    }

    #validationMessage.valid {
        color: var(--success);
    }

    #validationMessage.valid::before {
        content: '✓ ';
        font-weight: bold;
    }

    #validationMessage.invalid {
        color: var(--danger);
    }

    #validationMessage.invalid::before {
        content: '⚠ ';
        font-weight: bold;
    }

    /* Tombol Submit Styles - IMPROVED */
    #submitVote {
        width: 100%;
        margin-top: 1rem;
        font-size: 1.1rem;
        padding: 15px 30px;
        transition: all 0.3s ease;
    }

    #submitVote:not(:disabled) {
        background: var(--gold);
        cursor: pointer;
    }

    #submitVote:not(:disabled):hover {
        background: #b8860b;
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #submitVote:disabled {
        background: #cccccc !important;
        cursor: not-allowed !important;
        transform: none !important;
        box-shadow: none !important;
        opacity: 0.7;
    }

    #submitVote:disabled:hover {
        background: #cccccc !important;
        transform: none !important;
        box-shadow: none !important;
    }

    /* Admin Dashboard */
    .admin-section {
        display: none;
        background: white;
        border-radius: 10px;
        padding: 2rem;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        margin-bottom: 3rem;
    }

    .admin-controls {
        display: flex;
        justify-content: space-between;
        margin-bottom: 2rem;
    }

    .candidates-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 1.5rem;
    }

    .admin-candidate-card {
        background: white;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        border: 1px solid #eee;
    }

    .admin-candidate-actions {
        padding: 1rem;
        display: flex;
        justify-content: space-between;
        border-top: 1px solid #eee;
    }

    /* Modal Styles - IMPROVED */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        z-index: 1000;
        justify-content: center;
        align-items: flex-start;
        padding: 20px 0;
        overflow-y: auto;
    }

    .modal-content {
        background: white;
        width: 90%;
        max-width: 500px;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 5px 30px rgba(0, 0, 0, 0.3);
        margin: 20px auto;
        max-height: 90vh;
        overflow-y: auto;
        position: relative;
    }

    .modal-header {
        background: var(--maroon);
        color: white;
        padding: 1.5rem;
        text-align: center;
        position: sticky;
        top: 0;
        z-index: 1;
    }

    .modal-body {
        padding: 2rem;
    }

    .form-group {
        margin-bottom: 1.5rem;
    }

    .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
        color: var(--maroon);
    }

    .form-group input, .form-group textarea {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 1rem;
        transition: border-color 0.3s;
    }

    .form-group input:focus, .form-group textarea:focus {
        outline: none;
        border-color: var(--maroon);
        box-shadow: 0 0 0 2px rgba(128, 0, 0, 0.1);
    }

    .form-group textarea {
        min-height: 100px;
        resize: vertical;
    }

    .modal-footer {
        padding: 1rem 2rem;
        background: #f9f9f9;
        text-align: center;
        border-top: 1px solid #eee;
    }

    .close {
        position: absolute;
        top: 15px;
        right: 15px;
        font-size: 1.5rem;
        cursor: pointer;
        color: white;
        z-index: 2;
        background: rgba(0, 0, 0, 0.3);
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.3s;
    }

    .close:hover {
        background: rgba(0, 0, 0, 0.5);
    }

    /* CSS untuk foto */
    .photo-preview {
        max-width: 200px;
        max-height: 200px;
        border-radius: 10px;
        margin: 10px auto;
        display: block;
        border: 2px solid var(--maroon);
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    }

    /* Footer */
    footer {
        background: var(--dark-maroon);
        color: white;
        padding: 2rem 0;
        text-align: center;
    }

    .footer-content {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .footer-logo {
        font-size: 2rem;
        margin-bottom: 1rem;
        color: var(--gold);
    }

    .footer-links {
        display: flex;
        gap: 2rem;
        margin: 1rem 0;
    }

    .footer-links a {
        color: white;
        text-decoration: none;
        transition: color 0.3s;
    }

    .footer-links a:hover {
        color: var(--light-gold);
        text-decoration: underline;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .header-content {
            flex-wrap: wrap;
        }
        
        .logo {
            flex: 1;
        }
        
        .mobile-menu-btn {
            display: block;
        }
        
        nav {
            width: 100%;
            display: none;
            margin-top: 1rem;
        }
        
        nav.active {
            display: block;
        }
        
        nav ul {
            flex-direction: column;
            gap: 0;
        }
        
        nav ul li {
            margin: 0;
        }
        
        nav ul li a {
            padding: 12px 16px;
            border-radius: 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .user-info {
            margin: 10px 0;
            display: inline-flex;
            width: 100%;
            justify-content: center;
        }

        .hero h2 {
            font-size: 2rem;
        }

        .hero p {
            font-size: 1rem;
        }

        .admin-controls {
            flex-direction: column;
            gap: 1rem;
        }

        /* Vote options responsive */
        .vote-option {
            min-width: calc(50% - 0.5rem);
        }

        .vote-options {
            gap: 0.8rem;
        }

        /* Selection info responsive */
        .selection-info {
            padding: 1rem;
        }

        /* Modal improvements untuk mobile */
        .modal {
            padding: 10px 0;
            align-items: flex-start;
        }
        
        .modal-content {
            width: 95%;
            max-height: 95vh;
            margin: 10px auto;
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-group input, .form-group textarea {
            padding: 10px;
            font-size: 16px;
        }
        
        .photo-preview {
            max-width: 150px;
            max-height: 150px;
        }
    }

    @media (max-width: 480px) {
        .modal-body {
            padding: 1rem;
        }
        
        .modal-header {
            padding: 1rem;
        }
        
        .modal-header h2 {
            font-size: 1.3rem;
        }
        
        .photo-preview {
            max-width: 120px;
            max-height: 120px;
        }

        .vote-option {
            min-width: 100%;
        }

        .selection-counter p {
            font-size: 1rem;
        }

        #validationMessage {
            font-size: 0.9rem;
        }

        #submitVote {
            padding: 12px 20px;
            font-size: 1rem;
        }
    }

    /* Animation untuk feedback */
    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }

    .vote-option.selected {
        animation: pulse 0.3s ease;
    }
</style>
</head>
<body>
    <!-- Header -->
    <header>
        
        <div class="container header-content">
            <div class="logo">
                <div class="logo-icon">
                    <img src="picture/imm.png" alt="Logo IMM" style="width:50px; height:50px; border-radius:50%;">
                </div>
                <div class="logo-text">
                    <h1>IMM JPMIPA</h1>
                    <span>Ikatan Mahasiswa Muhammadiyah</span>
                </div>
            </div>
            
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
            
            <nav id="mainNav">
                <ul>
                    <li><a href="#" id="homeLink" class="active"><i class="fas fa-home"></i> Beranda</a></li>
                    <li><a href="#" id="candidatesLink"><i class="fas fa-users"></i> Kandidat</a></li>
                    <li><a href="#" id="voteLink"><i class="fas fa-vote-yea"></i> Voting</a></li>
                    <li><a href="#" id="adminLink" style="display:none;"><i class="fas fa-cog"></i> Admin</a></li>
                    <li><a href="login.html" id="loginLink"><i class="fas fa-sign-in-alt"></i> Login</a></li>
                    <li class="user-info" id="userInfo">
                        <i class="fas fa-user"></i>
                        <span id="userName"></span>
                    </li>
                    <li><a href="#" id="logoutLink" style="display:none;"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <h2>Sistem Pemilihan Formatur IMM JPMIPA 2025</h2>
            <p>Ikut berpartisipasi dalam menentukan masa depan organisasi dengan memilih calon Formatur IMM JPMIPA yang terbaik.</p>
            <a href="#" class="btn" id="voteNowBtn">Voting Sekarang</a>
        </div>
    </section>

    <!-- Candidates Section -->
    <section class="container">
        <h2 class="section-title">Calon Kandidat Formatur IMM JPMIPA 2025</h2>
        <div class="candidates" id="candidatesContainer">
            <!-- Kandidat akan dimuat secara dinamis -->
        </div>
    </section>

    <!-- Vote Section -->
    <section class="container">
        <h2 class="section-title">Pilih Calon Formatur IMM JPMIPA 2025</h2>
        <div class="vote-section">
            <p>Silakan pilih <strong>minimal 1 dan maksimal 13 calon</strong> Formatur IMM JPMIPA di bawah ini. Pastikan pilihan Anda sudah tepat sebelum mengirimkan suara.</p>
            
            <div class="vote-options" id="voteOptionsContainer">
                <!-- Opsi voting akan dimuat secara dinamis -->
            </div>
            
            <div style="margin: 1rem 0; padding: 1rem; background: #f8f9fa; border-radius: 5px;">
                <p><strong>Pilihan Anda:</strong> <span id="selectedCount">0</span>/13 kandidat terpilih</p>
                <p id="validationMessage" style="color: var(--maroon); font-size: 0.9rem; margin-top: 5px;"></p>
            </div>
            
            <button class="btn" id="submitVote" style="width: 100%;" disabled>Kirim Suara Saya</button>
        </div>
    </section>

    <!-- Admin Dashboard -->
    <section class="container">
        <div class="admin-section" id="adminSection">
            <h2 class="section-title">Dashboard Admin</h2>
            
            <div class="admin-controls">
                <button class="btn" id="addCandidateBtn">Tambah Kandidat</button>
                <button class="btn btn-secondary" id="viewResultsBtn">Lihat Hasil</button>
            </div>
            
            <div class="candidates-list" id="adminCandidatesList">
                <!-- Daftar kandidat untuk admin akan dimuat di sini -->
            </div>
        </div>
    </section>

    <!-- Add Candidate Modal -->
    <div class="modal" id="candidateModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="candidateModalTitle">Tambah Kandidat</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="candidateName">Nama Kandidat</label>
                    <input type="text" id="candidateName" placeholder="Masukkan nama kandidat">
                </div>
                <div class="form-group">
                    <label for="candidateProgram">Program Studi & Semester</label>
                    <input type="text" id="candidateProgram" placeholder="Contoh: Teknik Informatika - Semester 7">
                </div>
                <div class="form-group">
                    <label for="candidatePhoto">Foto Kandidat</label>
                    <button type="button" class="btn btn-secondary" id="uploadPhotoBtn" style="width: 100%; margin-bottom: 10px;">
                        <i class="fas fa-cloud-upload-alt"></i> Upload Foto
                    </button>
                    <div id="photoPreview" style="margin-top: 10px; text-align: center;"></div>
                </div>
                <div class="form-group">
                    <label for="candidateVision">Visi</label>
                    <textarea id="candidateVision" placeholder="Masukkan visi kandidat"></textarea>
                </div>
                <div class="form-group">
                    <label for="candidateMission">Misi (pisahkan dengan baris baru)</label>
                    <textarea id="candidateMission" placeholder="Masukkan misi kandidat, setiap misi dipisahkan dengan baris baru"></textarea>
                </div>
                <button class="btn" id="saveCandidateBtn" style="width: 100%;">Simpan Kandidat</button>
            </div>
        </div>
    </div>

    <!-- Results Modal -->
    <div class="modal" id="resultsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Hasil Pemilihan</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div id="resultsContainer">
                    <!-- Hasil voting akan ditampilkan di sini -->
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container footer-content">
            <div class="footer-logo">
                <img src="picture/imm.png" alt="Logo IMM" style="width:50px; height:50px; border-radius:50%;">
            </div>
            <p>Pemilihan Formatur IMM JPMIPA 2025</p>
            <div class="footer-links">
                <a href="#">Tentang</a>
                <a href="#">Kebijakan Privasi</a>
                <a href="#">Kontak</a>
            </div>
            <p>&copy; 2025 IMM JPMIPA. Semua hak dilindungi.</p>
        </div>
    </footer>

<script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDhJj0hNeDIsD3jxnOPxHWyvvfXwNUxE8I",
      authDomain: "immuad-1d18a.firebaseapp.com",
      projectId: "immuad-1d18a",
      storageBucket: "immuad-1d18a.firebasestorage.app",
      messagingSenderId: "558116990905",
      appId: "1:558116990905:web:27d7df924f28a089dbd068",
      measurementId: "G-0YBW40V890"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Cloudinary Configuration
    const cloudinaryConfig = {
        cloudName: 'dgysqnzx2',
        uploadPreset: 'imm_preset'
    };

    // DOM Elements
    const submitVoteBtn = document.getElementById('submitVote');
    const voteNowBtn = document.getElementById('voteNowBtn');
    const adminSection = document.getElementById('adminSection');
    const addCandidateBtn = document.getElementById('addCandidateBtn');
    const viewResultsBtn = document.getElementById('viewResultsBtn');
    const candidateModal = document.getElementById('candidateModal');
    const resultsModal = document.getElementById('resultsModal');
    const saveCandidateBtn = document.getElementById('saveCandidateBtn');
    const userInfo = document.getElementById('userInfo');
    const userName = document.getElementById('userName');
    const adminLink = document.getElementById('adminLink');
    const logoutLink = document.getElementById('logoutLink');
    const loginLink = document.getElementById('loginLink');
    const mobileMenuBtn = document.getElementById('mobileMenuBtn');
    const mainNav = document.getElementById('mainNav');
    const uploadPhotoBtn = document.getElementById('uploadPhotoBtn');
    const photoPreview = document.getElementById('photoPreview');
    
    const candidatesContainer = document.getElementById('candidatesContainer');
    const voteOptionsContainer = document.getElementById('voteOptionsContainer');
    const adminCandidatesList = document.getElementById('adminCandidatesList');
    const resultsContainer = document.getElementById('resultsContainer');

    // State variables - MODIFIED untuk minimal dan maksimal 13
    let selectedCandidates = []; // Array untuk menyimpan multiple selections
    let isAdmin = false;
    let editingCandidateId = null;
    let currentPhotoUrl = '';
    let uploadWidget = null;
    const REQUIRED_SELECTIONS = 13; // Harus memilih tepat 13 kandidat

    // Mobile menu toggle
    mobileMenuBtn.addEventListener('click', () => {
        mainNav.classList.toggle('active');
    });

    // Update active nav link
    function updateActiveNavLink(activeLinkId) {
        document.querySelectorAll('nav a').forEach(link => {
            link.classList.remove('active');
        });
        document.getElementById(activeLinkId).classList.add('active');
    }

    // Check if user is already logged in
    function checkAuthState() {
        auth.onAuthStateChanged((user) => {
            if (user) {
                // User is signed in
                getUserData(user.uid).then(userData => {
                    if (userData) {
                        updateUIForLoggedInUser(userData);
                        // Set isAdmin berdasarkan data user
                        isAdmin = userData.isAdmin || false;
                        
                        // Jika admin, load candidates untuk admin juga
                        if (isAdmin) {
                            loadAdminCandidates();
                        }
                    }
                });
            } else {
                // User is signed out
                console.log('User is signed out');
                // Reset UI
                loginLink.style.display = 'block';
                userInfo.style.display = 'none';
                logoutLink.style.display = 'none';
                adminLink.style.display = 'none';
                adminSection.style.display = 'none';
                isAdmin = false;
                // Reset pilihan voting
                resetVoteSelection();
            }
        });
        
        loadCandidates();
        
        // Initialize counter dan tombol submit
        updateSelectedCounter();
        updateSubmitButton();
        updateVoteOptionsState();
    }

    // Get user data from Firestore
    function getUserData(uid) {
        return db.collection('users').doc(uid).get()
            .then((doc) => {
                if (doc.exists) {
                    return doc.data();
                } else {
                    console.log("No such document!");
                    return null;
                }
            })
            .catch((error) => {
                console.error("Error getting user data:", error);
                return null;
            });
    }

    // Update UI for logged in user
    function updateUIForLoggedInUser(user) {
        loginLink.style.display = 'none';
        userInfo.style.display = 'flex';
        userName.textContent = user.name;
        logoutLink.style.display = 'block';
        
        // Show admin link if user is admin
        if (user.isAdmin) {
            adminLink.style.display = 'block';
            isAdmin = true;
        }
    }

    // Load candidates from Firestore untuk public view
    function loadCandidates() {
        db.collection('candidates').orderBy('createdAt', 'asc').get()
            .then((querySnapshot) => {
                candidatesContainer.innerHTML = '';
                voteOptionsContainer.innerHTML = '';
                
                if (querySnapshot.empty) {
                    candidatesContainer.innerHTML = '<p>Belum ada kandidat yang terdaftar.</p>';
                    voteOptionsContainer.innerHTML = '<p>Belum ada kandidat yang terdaftar.</p>';
                    return;
                }
                
                querySnapshot.forEach((doc) => {
                    const candidate = doc.data();
                    candidate.id = doc.id;
                    
                    // Render candidate cards for public view
                    renderCandidateCard(candidate);
                    
                    // Render vote options
                    renderVoteOption(candidate);
                });
            })
            .catch((error) => {
                console.error("Error loading candidates: ", error);
                candidatesContainer.innerHTML = '<p>Error loading candidates.</p>';
            });
    }

    // Load candidates untuk admin view
    function loadAdminCandidates() {
        db.collection('candidates').orderBy('createdAt', 'asc').get()
            .then((querySnapshot) => {
                adminCandidatesList.innerHTML = '';
                
                if (querySnapshot.empty) {
                    adminCandidatesList.innerHTML = '<p>Belum ada kandidat yang terdaftar.</p>';
                    return;
                }
                
                querySnapshot.forEach((doc) => {
                    const candidate = doc.data();
                    candidate.id = doc.id;
                    
                    // Render admin candidate cards
                    renderAdminCandidateCard(candidate);
                });
            })
            .catch((error) => {
                console.error("Error loading admin candidates: ", error);
                adminCandidatesList.innerHTML = '<p>Error loading candidates.</p>';
            });
    }

    // Fungsi untuk inisialisasi Cloudinary upload widget
    function initializeCloudinaryWidget() {
        if (!uploadWidget) {
            uploadWidget = cloudinary.createUploadWidget({
                cloudName: cloudinaryConfig.cloudName,
                uploadPreset: cloudinaryConfig.uploadPreset,
                sources: ['local', 'camera'],
                multiple: false,
                maxFileSize: 5000000, // 5MB
                clientAllowedFormats: ['jpg', 'jpeg', 'png', 'gif'],
                maxImageWidth: 800,
                maxImageHeight: 800,
                cropping: true,
                croppingAspectRatio: 1,
                showAdvancedOptions: false,
                styles: {
                    palette: {
                        window: "#FFFFFF",
                        sourceBg: "#F4F4F5",
                        windowBorder: "#90a0b3",
                        tabIcon: "#800000",
                        inactiveTabIcon: "#69778A",
                        menuIcons: "#800000",
                        link: "#800000",
                        action: "#800000",
                        inProgress: "#800000",
                        complete: "#20b832",
                        error: "#c43737",
                        textDark: "#000000",
                        textLight: "#FFFFFF"
                    }
                }
            }, (error, result) => {
                if (!error && result && result.event === "success") {
                    console.log('Upload berhasil: ', result.info);
                    currentPhotoUrl = result.info.secure_url;
                    showPhotoPreview(currentPhotoUrl);
                } else if (error) {
                    console.error('Upload error: ', error);
                    alert('Terjadi kesalahan saat upload foto: ' + error.message);
                }
            });
        }
        return uploadWidget;
    }

    // Fungsi untuk menampilkan preview foto
    function showPhotoPreview(url) {
        const previewContainer = document.getElementById('photoPreview');
        previewContainer.innerHTML = `
            <img src="${url}" alt="Preview Foto" class="photo-preview">
            <p style="color: green; margin-top: 5px; font-size: 0.9rem;">
                <i class="fas fa-check-circle"></i> Foto berhasil diupload
            </p>
            <button type="button" class="btn btn-danger" id="removePhotoBtn" style="margin-top: 5px; padding: 5px 10px; font-size: 0.8rem;">
                <i class="fas fa-trash"></i> Hapus Foto
            </button>
        `;
        
        // Event listener untuk hapus foto
        document.getElementById('removePhotoBtn').addEventListener('click', function() {
            currentPhotoUrl = '';
            previewContainer.innerHTML = '';
        });
    }

    // Render candidate card for public view
    function renderCandidateCard(candidate) {
        const missionItems = candidate.mission.split('\n').map(item => 
            `<li>${item}</li>`
        ).join('');
        
        const candidateCard = document.createElement('div');
        candidateCard.className = 'candidate-card';
        candidateCard.innerHTML = `
            <div class="candidate-img">
                ${candidate.photoUrl ? 
                    `<img src="${candidate.photoUrl}" alt="${candidate.name}" onerror="this.style.display='none'; this.parentElement.innerHTML='<i class=\\'fas fa-user\\'></i>'">` : 
                    `<i class="fas fa-user"></i>`
                }
            </div>
            <div class="candidate-info">
                <h3>${candidate.name}</h3>
                <p>${candidate.program}</p>
                <p><strong>Visi:</strong> ${candidate.vision}</p>
                <p><strong>Misi:</strong></p>
                <ul>${missionItems}</ul>
            </div>
        `;
        candidatesContainer.appendChild(candidateCard);
    }

    // Render vote option - MODIFIED untuk tepat 13 pilihan
    function renderVoteOption(candidate) {
        const voteOption = document.createElement('div');
        voteOption.className = 'vote-option';
        voteOption.setAttribute('data-candidate', candidate.id);
        voteOption.innerHTML = `
            <div class="vote-option-img">
                ${candidate.photoUrl ? 
                    `<img src="${candidate.photoUrl}" alt="${candidate.name}" onerror="this.style.display='none'; this.parentElement.innerHTML='<i class=\\'fas fa-user\\' style=\\'font-size: 2rem; color: #800000;\\'></i>'">` : 
                    `<i class="fas fa-user" style="font-size: 2rem; color: #800000;"></i>`
                }
            </div>
            <h3>${candidate.name}</h3>
            <p>${candidate.program}</p>
        `;
        
        voteOption.addEventListener('click', () => {
            const candidateId = candidate.id;
            
            // Cek apakah kandidat sudah dipilih
            const isSelected = selectedCandidates.includes(candidateId);
            
            if (isSelected) {
                // Hapus dari selection
                selectedCandidates = selectedCandidates.filter(id => id !== candidateId);
                voteOption.classList.remove('selected');
            } else {
                // Cek apakah sudah mencapai batas maksimal
                if (selectedCandidates.length >= REQUIRED_SELECTIONS) {
                    alert(`Anda harus memilih tepat ${REQUIRED_SELECTIONS} kandidat. Silakan batalkan pilihan salah satu kandidat terlebih dahulu.`);
                    return;
                }
                
                // Tambahkan ke selection
                selectedCandidates.push(candidateId);
                voteOption.classList.add('selected');
            }
            
            // Update semua state
            updateSelectedCounter();
            updateSubmitButton();
            updateVoteOptionsState();
        });
        
        voteOptionsContainer.appendChild(voteOption);
    }

    // Fungsi untuk update counter pilihan
    function updateSelectedCounter() {
        const selectedCountElement = document.getElementById('selectedCount');
        const validationMessage = document.getElementById('validationMessage');
        
        if (selectedCountElement) {
            selectedCountElement.textContent = selectedCandidates.length;
        }
        
        // Update validation message
        if (validationMessage) {
            if (selectedCandidates.length < REQUIRED_SELECTIONS) {
                const remaining = REQUIRED_SELECTIONS - selectedCandidates.length;
                validationMessage.textContent = `Pilih ${remaining} kandidat lagi untuk mencapai ${REQUIRED_SELECTIONS} kandidat`;
                validationMessage.className = 'invalid';
            } else if (selectedCandidates.length === REQUIRED_SELECTIONS) {
                validationMessage.textContent = '✓ Anda telah memilih tepat 13 kandidat. Silakan kirim suara.';
                validationMessage.className = 'valid';
            } else {
                validationMessage.textContent = `Anda harus memilih tepat ${REQUIRED_SELECTIONS} kandidat`;
                validationMessage.className = 'invalid';
            }
        }
    }

    // Fungsi untuk update status tombol submit
    function updateSubmitButton() {
        const submitBtn = document.getElementById('submitVote');
        const isValid = selectedCandidates.length === REQUIRED_SELECTIONS;
        
        if (isValid) {
            submitBtn.disabled = false;
            submitBtn.style.opacity = '1';
            submitBtn.style.cursor = 'pointer';
            submitBtn.style.background = 'var(--gold)';
        } else {
            submitBtn.disabled = true;
            submitBtn.style.opacity = '0.6';
            submitBtn.style.cursor = 'not-allowed';
            submitBtn.style.background = '#cccccc';
        }
    }

    // Fungsi untuk update state vote options
    function updateVoteOptionsState() {
        const voteOptions = document.querySelectorAll('.vote-option');
        const hasReachedMax = selectedCandidates.length >= REQUIRED_SELECTIONS;
        
        voteOptions.forEach(option => {
            const candidateId = option.getAttribute('data-candidate');
            const isSelected = selectedCandidates.includes(candidateId);
            
            if (hasReachedMax && !isSelected) {
                option.classList.add('max-reached');
            } else {
                option.classList.remove('max-reached');
            }
        });
    }

    // Render admin candidate card
    function renderAdminCandidateCard(candidate) {
        const adminCard = document.createElement('div');
        adminCard.className = 'admin-candidate-card';
        adminCard.innerHTML = `
            <div class="candidate-img">
                ${candidate.photoUrl ? 
                    `<img src="${candidate.photoUrl}" alt="${candidate.name}" onerror="this.style.display='none'; this.parentElement.innerHTML='<i class=\\'fas fa-user\\'></i>'">` : 
                    `<i class="fas fa-user"></i>`
                }
            </div>
            <div class="candidate-info">
                <h3>${candidate.name}</h3>
                <p>${candidate.program}</p>
                <p><strong>Visi:</strong> ${candidate.vision}</p>
            </div>
            <div class="admin-candidate-actions">
                <button class="btn btn-secondary edit-candidate" data-id="${candidate.id}">Edit</button>
                <button class="btn btn-danger delete-candidate" data-id="${candidate.id}">Hapus</button>
            </div>
        `;
        
        adminCandidatesList.appendChild(adminCard);
        
        // Add event listeners for edit and delete buttons
        adminCard.querySelector('.edit-candidate').addEventListener('click', () => {
            editCandidate(candidate);
        });
        
        adminCard.querySelector('.delete-candidate').addEventListener('click', () => {
            deleteCandidate(candidate.id);
        });
    }

    // Edit candidate
    function editCandidate(candidate) {
        editingCandidateId = candidate.id;
        currentPhotoUrl = candidate.photoUrl || '';
        
        document.getElementById('candidateModalTitle').textContent = 'Edit Kandidat';
        document.getElementById('candidateName').value = candidate.name;
        document.getElementById('candidateProgram').value = candidate.program;
        document.getElementById('candidateVision').value = candidate.vision;
        document.getElementById('candidateMission').value = candidate.mission;
        
        // Tampilkan preview foto jika ada
        if (candidate.photoUrl) {
            showPhotoPreview(candidate.photoUrl);
        } else {
            document.getElementById('photoPreview').innerHTML = '';
        }
        
        candidateModal.style.display = 'flex';
    }

    // Delete candidate
    function deleteCandidate(candidateId) {
        if (confirm('Apakah Anda yakin ingin menghapus kandidat ini?')) {
            db.collection('candidates').doc(candidateId).delete()
                .then(() => {
                    alert('Kandidat berhasil dihapus');
                    // Reload both public and admin views
                    loadCandidates();
                    if (isAdmin) {
                        loadAdminCandidates();
                    }
                })
                .catch((error) => {
                    console.error("Error deleting candidate: ", error);
                    alert('Terjadi kesalahan saat menghapus kandidat');
                });
        }
    }

    // Show voting results - MODIFIED untuk multiple votes
    function showResults() {
        resultsContainer.innerHTML = '<p>Memuat hasil...</p>';
        resultsModal.style.display = 'flex';
        
        // Get all votes
        db.collection('votes').get()
            .then((querySnapshot) => {
                const votes = {};
                let totalVotes = 0;
                
                // Initialize vote counts
                db.collection('candidates').get()
                    .then((candidatesSnapshot) => {
                        candidatesSnapshot.forEach((doc) => {
                            votes[doc.id] = {
                                name: doc.data().name,
                                count: 0
                            };
                        });
                        
                        // Count votes (setiap vote dihitung satu)
                        querySnapshot.forEach((doc) => {
                            const vote = doc.data();
                            if (votes[vote.candidate]) {
                                votes[vote.candidate].count++;
                                totalVotes++;
                            }
                        });
                        
                        // Calculate unique voters
                        const uniqueVoters = new Set();
                        querySnapshot.forEach(doc => {
                            uniqueVoters.add(doc.data().userId);
                        });
                        
                        // Display results
                        let resultsHTML = `
                            <p><strong>Total Pemilih: ${uniqueVoters.size}</strong></p>
                            <p><strong>Total Suara: ${totalVotes}</strong></p>
                        `;
                        
                        // Urutkan berdasarkan jumlah suara terbanyak
                        const sortedCandidates = Object.keys(votes)
                            .map(id => ({ id, ...votes[id] }))
                            .sort((a, b) => b.count - a.count);
                        
                        sortedCandidates.forEach(candidate => {
                            const percentage = totalVotes > 0 ? 
                                ((candidate.count / totalVotes) * 100).toFixed(2) : 0;
                            
                            resultsHTML += `
                                <div style="margin-bottom: 1rem; padding: 1rem; background: #f9f9f9; border-radius: 5px;">
                                    <h3>${candidate.name}</h3>
                                    <p>Suara: ${candidate.count} (${percentage}%)</p>
                                    <div style="background: #e0e0e0; height: 20px; border-radius: 10px; margin-top: 5px;">
                                        <div style="background: var(--maroon); height: 100%; width: ${percentage}%; border-radius: 10px;"></div>
                                    </div>
                                </div>
                            `;
                        });
                        
                        resultsContainer.innerHTML = resultsHTML;
                    });
            })
            .catch((error) => {
                console.error("Error loading results: ", error);
                resultsContainer.innerHTML = '<p>Terjadi kesalahan saat memuat hasil.</p>';
            });
    }

    // Event Listeners
    const closeModal = document.querySelectorAll('.close');
    closeModal.forEach(closeBtn => {
        closeBtn.addEventListener('click', () => {
            candidateModal.style.display = 'none';
            resultsModal.style.display = 'none';
            editingCandidateId = null;
            currentPhotoUrl = '';
            document.getElementById('photoPreview').innerHTML = '';
        });
    });

    window.addEventListener('click', (e) => {
        if (e.target === candidateModal) {
            candidateModal.style.display = 'none';
            editingCandidateId = null;
            currentPhotoUrl = '';
            document.getElementById('photoPreview').innerHTML = '';
        }
        if (e.target === resultsModal) {
            resultsModal.style.display = 'none';
        }
    });

    // Event listener untuk upload photo button
    document.getElementById('uploadPhotoBtn').addEventListener('click', function() {
        const widget = initializeCloudinaryWidget();
        widget.open();
    });

    addCandidateBtn.addEventListener('click', () => {
        // Check if user is admin
        if (!isAdmin) {
            alert('Hanya admin yang dapat menambah kandidat!');
            return;
        }
        
        editingCandidateId = null;
        currentPhotoUrl = '';
        document.getElementById('candidateModalTitle').textContent = 'Tambah Kandidat';
        document.getElementById('candidateName').value = '';
        document.getElementById('candidateProgram').value = '';
        document.getElementById('candidateVision').value = '';
        document.getElementById('candidateMission').value = '';
        document.getElementById('photoPreview').innerHTML = '';
        candidateModal.style.display = 'flex';
    });

    viewResultsBtn.addEventListener('click', () => {
        showResults();
    });

    saveCandidateBtn.addEventListener('click', () => {
        // Check if user is admin
        if (!isAdmin) {
            alert('Hanya admin yang dapat menambah atau mengedit kandidat!');
            return;
        }
        
        const name = document.getElementById('candidateName').value;
        const program = document.getElementById('candidateProgram').value;
        const vision = document.getElementById('candidateVision').value;
        const mission = document.getElementById('candidateMission').value;
        
        if (!name || !program || !vision || !mission) {
            alert('Silakan isi semua data kandidat!');
            return;
        }
        
        const candidateData = {
            name,
            program,
            vision,
            mission,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        // Tambahkan photoUrl jika ada
        if (currentPhotoUrl) {
            candidateData.photoUrl = currentPhotoUrl;
        }
        
        if (editingCandidateId) {
            // Update existing candidate - pertahankan foto lama jika tidak ada foto baru
            if (!currentPhotoUrl) {
                // Ambil data kandidat yang ada untuk mempertahankan photoUrl
                db.collection('candidates').doc(editingCandidateId).get()
                    .then((doc) => {
                        if (doc.exists) {
                            const existingData = doc.data();
                            candidateData.photoUrl = existingData.photoUrl;
                        }
                        // Tambahkan createdAt untuk data yang sudah ada
                        candidateData.createdAt = existingData.createdAt;
                        return db.collection('candidates').doc(editingCandidateId).update(candidateData);
                    })
                    .then(() => {
                        handleSaveSuccess();
                    })
                    .catch((error) => {
                        console.error("Error updating candidate: ", error);
                        alert('Terjadi kesalahan saat memperbarui kandidat');
                    });
            } else {
                // Jika ada foto baru, update termasuk photoUrl
                db.collection('candidates').doc(editingCandidateId).get()
                    .then((doc) => {
                        if (doc.exists) {
                            const existingData = doc.data();
                            candidateData.createdAt = existingData.createdAt;
                        }
                        return db.collection('candidates').doc(editingCandidateId).update(candidateData);
                    })
                    .then(() => {
                        handleSaveSuccess();
                    })
                    .catch((error) => {
                        console.error("Error updating candidate: ", error);
                        alert('Terjadi kesalahan saat memperbarui kandidat');
                    });
            }
        } else {
            // Add new candidate
            candidateData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
            db.collection('candidates').add(candidateData)
                .then(() => {
                    handleSaveSuccess();
                })
                .catch((error) => {
                    console.error("Error adding candidate: ", error);
                    alert('Terjadi kesalahan saat menambahkan kandidat');
                });
        }
        
        function handleSaveSuccess() {
            alert(editingCandidateId ? 'Kandidat berhasil diperbarui' : 'Kandidat berhasil ditambahkan');
            candidateModal.style.display = 'none';
            // Reset form
            document.getElementById('candidateName').value = '';
            document.getElementById('candidateProgram').value = '';
            document.getElementById('candidateVision').value = '';
            document.getElementById('candidateMission').value = '';
            document.getElementById('photoPreview').innerHTML = '';
            currentPhotoUrl = '';
            editingCandidateId = null;
            // Reload both views
            loadCandidates();
            if (isAdmin) {
                loadAdminCandidates();
            }
        }
    });

    // Event listener untuk submit vote - MODIFIED untuk tepat 13 pilihan
    submitVoteBtn.addEventListener('click', () => {
        // Validasi final sebelum submit
        if (selectedCandidates.length !== REQUIRED_SELECTIONS) {
            alert(`Anda harus memilih tepat ${REQUIRED_SELECTIONS} kandidat! Saat ini Anda memilih ${selectedCandidates.length} kandidat.`);
            return;
        }
        
        const user = auth.currentUser;
        if (!user) {
            alert('Anda harus login terlebih dahulu untuk melakukan voting!');
            window.location.href = 'login.html';
            return;
        }
        
        // Konfirmasi sebelum submit
        const confirmation = confirm(`Anda akan mengirimkan suara untuk ${selectedCandidates.length} kandidat. Apakah Anda yakin dengan pilihan Anda?`);
        if (!confirmation) {
            return;
        }
        
        // Check if user has already voted
        db.collection('votes').where('userId', '==', user.uid).get()
            .then((querySnapshot) => {
                if (!querySnapshot.empty) {
                    alert('Anda sudah melakukan voting sebelumnya!');
                    return;
                }
                
                // Save multiple votes to Firestore
                const votePromises = selectedCandidates.map(candidateId => {
                    return db.collection('votes').add({
                        candidate: candidateId,
                        userId: user.uid,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    });
                });
                
                return Promise.all(votePromises);
            })
            .then(() => {
                alert(`Terima kasih! ${selectedCandidates.length} suara Anda telah tercatat.`);
                // Reset selection
                resetVoteSelection();
            })
            .catch(error => {
                console.error('Error saving votes: ', error);
                alert('Terjadi kesalahan. Silakan coba lagi.');
            });
    });

    // Fungsi untuk reset pilihan voting - MODIFIED
    function resetVoteSelection() {
        // Reset UI
        document.querySelectorAll('.vote-option').forEach(opt => {
            opt.classList.remove('selected');
            opt.classList.remove('max-reached');
        });
        selectedCandidates = [];
        
        // Update semua state
        updateSelectedCounter();
        updateSubmitButton();
        updateVoteOptionsState();
    }

    voteNowBtn.addEventListener('click', (e) => {
        e.preventDefault();
        document.getElementById('voteLink').click();
    });

    // Event listener untuk admin link
    adminLink.addEventListener('click', (e) => {
        e.preventDefault();
        // Sembunyikan semua section
        document.querySelector('.hero').style.display = 'none';
        document.querySelector('.candidates').style.display = 'none';
        document.querySelector('.vote-section').style.display = 'none';
        
        // Tampilkan admin section
        adminSection.style.display = 'block';
        
        // Update active nav link
        updateActiveNavLink('adminLink');
        
        // Load candidates untuk admin jika belum diload
        if (isAdmin) {
            loadAdminCandidates();
        }
        
        window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    logoutLink.addEventListener('click', (e) => {
        e.preventDefault();
        auth.signOut().then(() => {
            // Sign-out successful.
            loginLink.style.display = 'block';
            userInfo.style.display = 'none';
            logoutLink.style.display = 'none';
            adminLink.style.display = 'none';
            adminSection.style.display = 'none';
            isAdmin = false;
            
            // Show hidden sections
            document.querySelector('.hero').style.display = 'block';
            document.querySelector('.candidates').style.display = 'grid';
            document.querySelector('.vote-section').style.display = 'block';
            
            // Update active nav link
            updateActiveNavLink('homeLink');
            
            // Reset pilihan voting
            resetVoteSelection();
            
            alert('Logout berhasil!');
        }).catch((error) => {
            console.error('Error signing out:', error);
        });
    });

    // Navigation
    document.getElementById('homeLink').addEventListener('click', (e) => {
        e.preventDefault();
        adminSection.style.display = 'none';
        document.querySelector('.hero').style.display = 'block';
        document.querySelector('.candidates').style.display = 'grid';
        document.querySelector('.vote-section').style.display = 'block';
        
        // Update active nav link
        updateActiveNavLink('homeLink');
        
        window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    document.getElementById('candidatesLink').addEventListener('click', (e) => {
        e.preventDefault();
        adminSection.style.display = 'none';
        document.querySelector('.hero').style.display = 'block';
        document.querySelector('.candidates').style.display = 'grid';
        document.querySelector('.vote-section').style.display = 'block';
        
        // Update active nav link
        updateActiveNavLink('candidatesLink');
        
        document.querySelector('.section-title').scrollIntoView({ behavior: 'smooth' });
    });

    document.getElementById('voteLink').addEventListener('click', (e) => {
        e.preventDefault();
        adminSection.style.display = 'none';
        document.querySelector('.hero').style.display = 'block';
        document.querySelector('.candidates').style.display = 'grid';
        document.querySelector('.vote-section').style.display = 'block';
        
        // Update active nav link
        updateActiveNavLink('voteLink');
        
        document.getElementById('submitVote').scrollIntoView({ behavior: 'smooth' });
    });

    // Check authentication state on page load
    document.addEventListener('DOMContentLoaded', checkAuthState);
</script>
</body>
</html>
